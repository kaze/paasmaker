{% extends "../layout/main.html" %}

{% block pagetitle %}
	<h1>Router Table Dump</h1>
{% end %}

{% block body %}
	<p class="lead">This a dump of the routing table directly from the Redis instance.</p>

	<p>The serial number is currently {{ serial }}.</p>

	<table class="table table-striped table-bordered">
		<tr>
			<th>
				Hostname
			</th>
			<th>
				Instances
			</th>
			<th>
				Routes
			</th>
		</tr>
		{% for entry in table %}
			<tr>
				<td><a target="_blank" href="http://{{ entry['hostname'] }}{{ frontend_domain_postfix }}">{{ entry['hostname'] }}</a></td>
				<td>
					{% for instance in entry['instances'] %}
						<code>{{ instance.instance_id[0:8] }}</code>
						({{ instance.node.name }},
						{{ instance.application_instance_type.application_version.application.name }},
						<span class="instance-{{ instance.state }}">{{ nice_state(instance.state) }}</span>,
						v{{ instance.application_instance_type.application_version.version }},
						{% if instance.application_instance_type.application_version.is_current %}
							Current)<br />
						{% else %}
							Not Current)<br />
						{% end %}
					{% end %}
					{% for node in entry['nodes'] %}
						<code>{{ node.uuid[0:8] }}</code>
						(Pacemaker {{ node.name }},
						<span class="node-{{ node.state }}">{{ nice_state(node.state) }}</span>)
					{% end %}
				</td>
				<td>
					{% for route in entry['routes'] %}
						{{ route }}<br />
					{% end %}
				</td>
			</tr>
		{% end %}
	</table>

{% end %}
