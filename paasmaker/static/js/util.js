define([
	'jquery',
	'underscore',
	'backbone',
	'moment',
], function($, _, Backbone, moment) {
	var module = {};

	module.dateFormats = {
		pacemaker: 'YYYY-MM-DD_HH:mm:ss.______ Z',
		word: 'MMMM Do YYYY, HH:mm:ss Z'
	};

	/**
	 * Parse a date string generated by the pacemaker in ISO-8601 format
	 * (which include microseconds but don't include the timezone, UTC),
	 * and return a moment.js object for arithmetic, formatting, etc.
	 */
	module.parseDate = function(dateString) {
		return moment(dateString + ' +0000', module.dateFormats.pacemaker);
	};

	module.shrinkUuids = function(scope) {
		$('code.uuid-shrink', scope).each(function(i, el) {
			el = $(el);
			el.text(el.attr('title').substr(0,8));
			el.on('click', module.shrinkClickHandler);
		});
	};

	module.shrinkClickHandler = function(e) {
		var el = $(e.target);
		if (el.text().length > 8) {
			el.text(el.attr('title').substr(0,8));
		} else {
			el.text(el.attr('title'));
		}
	};

	return module;
});